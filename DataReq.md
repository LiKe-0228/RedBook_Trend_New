## 数据分析方向

1. **增量优先的时间视角（排名 + 区间占比变化）**
   - 以 `fetch_date` 为主轴，但不求精确数值增量，而是比较“同一指标区间的数量变化”和“排名差值”。
   - 关注“跑得快”的品类：某区间（如阅读 5万-7万）在最近 7/14 天的占比明显提升，或同一账号/笔记的排名持续上升。

2. **内容榜（note_rank）**
   - 字段：`title、nickname、publish_time、read_count、click_rate、pay_conversion_rate、gmv`。
   - 当前库里的区间档位示例：
     - 阅读数：`1000-3000`, `3000-5000`, `5000-7000`, `7000-9000`, `9000-1万`, `1万-3万`, `3万-5万`, `5万-7万`, `7万-10万`, `10万以上`
     - 商品点击率：`0-5%`, `5%-15%`, `15%-25%`, `25%-50%`, `50%-70%`
     - 支付转化率：`25%-50%`, `50%-70%`
     - GMV：`￥0-1000`, `￥1000-5000`
   - 分析点：
     - 阅读→点击→支付→GMV 的“区间跃迁”：记录每条笔记在不同区间的档位，比较最新两天档位变化（如点击率从 5%-15% 跃迁到 15%-25%）。
     - `publish_time` 维度：统计“最近 7 天发布的笔记”在高档位区间中的占比变化，识别突然爆火的新品。
     - 同一 `nickname` 下多条笔记的排名差值 + 区间提升次数，作为账号层面的热度信号。

3. **账号榜（account_rank）**
   - 字段：`shop_name、fans_count、read_count、click_rate、pay_conversion_rate、gmv`。
   - 当前库里的区间档位示例：
     - 阅读数：同内容榜（`1000-3000` 至 `10万以上` 共 10 档）
     - 商品点击率：`0-5%`, `5%-15%`, `15%-25%`, `25%-50%`
     - 支付转化率：`0-5%`, `5%-15%`, `15%-25%`, `25%-50%`
     - GMV：`￥1000-5000`, `5000-1万`, `1万-5万`
   - 分析点：
     - 粉丝数区间 vs GMV 区间的组合频次：找出“粉丝区间低但成交区间高”的黑马店。
     - 排名变化（rank 差值）+ 区间跃迁双指标判断：“排名升幅大且 GMV/支付率区间提升”的卖家。
     - 统一把区间映射为档位编码（例如 阅读 1000-3000=档 1，5万-7万=档 4），用于后端统计和前端显示。

4. **内容榜 / 账号榜独立分析**
   - `nickname` 与 `shop_name` 经常不同步，不强行关联；分别围绕各自排名与指标区间进行分析即可。

5. **数据完整性（audit_log）**
   - 暂不做图表，仅用于后台校验采集量是否连续，为增量计算提供可靠数据基础。

## 可视化方案（聚焦近期增量）

| 目标 | 图表类型 | 说明 |
| --- | --- | --- |
| 近 7/14 天排名变化 | 基础折线图 | X 轴 `fetch_date`，Y 轴为“平均排名差”或“Top N 排名变动数量”，不依赖具体数值。 |
| 当天区间跃迁 Top10 | 横向条形图 | 统计“从低档位跃迁到高档位”的笔记/店铺数量，条形长度代表跃迁次数，颜色标识对应指标区间。 |
| 店铺排名 vs 区间档位 | 散点/气泡图 | X=粉丝数档位、Y=当前排名，气泡颜色代表 GMV 档位变化（上升/下降/持平）。 |
| 区间对比柱状图 | 分组柱状 | 两天内同一对象的“指标档位”并排展示，直观看出档位提升或下降。 |
| 排名变化热度矩阵 | Heatmap | 行=店铺，列=日期，颜色=排名差值，附文字标注区间跃迁（如“点击率档 2→4”）。 |

> 图表优先展示“日增”或“排名变化”，必要时再补充累计数据作为参考。

## 最新排名变化页面（独立页）

- 页面目的：对比“最新一天 vs 前一天”，虽然指标是区间，但可以通过以下策略复用：
  - **区间编码**：将如「1000-3000」「5万-7万」映射为档位 1、2、3…，用于判断区间提升/下降。
  - **区间合并**：对读数区间取中位值或上限（仅在可视化时使用），便于绘制折线/柱状并标注“区间范围”。
- 数据源：`note_rank` 或 `account_rank` 中最新两个 `fetch_date`。
- 表格设计：
  - 列 1：排名变化指示（绿色 ↑ + 数值表示上升名次；红色 ↓ + 数值表示下降名次；横向 `—` 表示持平）。
  - 列 2：当前排名、列 3：上一次排名，随后是 GMV/阅读数/点击率/支付率的“当前值”和“前一天值”以及“增量”。
  - 可加筛选：只看“涨幅超过 N 名”的记录。
- 交互：支持切换内容榜/账号榜，支持导出当前比较结果。

## 导航与页面布局

- 整体布局调整为“左侧导航 + 右侧内容”：
  - 左侧固定导航栏包含几个入口：`笔记榜概览`、`账号榜概览`、`排名变化`、`区间跃迁`, `审计日志`（预留）。
  - 每个入口对应右侧的 Tab/页面，通用顶部保留查询区（关键词、日期）。
  - 导航项可直接跳转到对应页面；当前页面高亮。
- 右侧内容区保持现有结构：顶部操作区（查询、重置），下方是表格或图表区域。
- 移动端/窄屏可折叠导航栏，由汉堡 Icon 控制展开/收起。

## 后端接口建议（支持增量分析与页面）

- 新增聚合/比较 API（示例）：
- `GET /api/stats/note_increment?days=14`：返回按日期的“区间占比”与“平均排名差”序列。
- `GET /api/stats/note_top_increment?date=2025-11-18&metric=gmv&limit=10`：返回区间跃迁次数最多的笔记集合。
- `GET /api/stats/account_rank_change?date=2025-11-18`：返回最新 vs 前一天的排名差值及区间档位变化（供排名变化页面使用）。
- 实现要点：
  - SQLite 中进行自连接（`current.fetch_date = target` 与 `previous.fetch_date = target - 1`）计算差值。
  - 对散点/热力类接口，可按日期窗口聚合后再返回列表。
  - 缓存策略：以日期为 key 缓存计算结果，减少重复查询。
